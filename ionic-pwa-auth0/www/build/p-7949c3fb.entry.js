import{r as t,h as o,H as e}from"./p-f4d894c7.js";import{p as n}from"./p-6b1b0178.js";import{i as a,p as i}from"./p-f665978e.js";import{a as r}from"./p-9e2c705a.js";import"./p-60e5b1e5.js";import"./p-f2660943.js";import"./p-972edcb2.js";const s=class{constructor(o){t(this,o)}async login(){await r.loginWithRedirect()}async callAPI(){try{const t=await r.getTokenSilently(),o=await fetch("http://localhost:3000/api/file/sunrise-baseline.jpg",{headers:{Authorization:`Bearer ${t}`},credentials:"include"});if(!o.ok)throw Error(`${o.status} ${o.statusText}`);if(!o.body)throw Error("Readable not yet supported in this browser.");const e=o.headers.get("Content-Length");if(null===e)throw Error("Response size header unavailable");const n=parseInt(e,10);let i=0;a.hidden=!1;const s=await new Response(new ReadableStream({start(t){const e=o.body.getReader();!async function o(){try{const{done:r,value:s}=await e.read();if(r)return void t.close();i+=s.byteLength,a.value=i/n,t.enqueue(s),o()}catch(o){t.error(o)}}()}})).blob();document.querySelector("#result").setAttribute("src",URL.createObjectURL(s))}catch({message:t}){i(t)}finally{a.hidden=!0,a.value=0}}async presentPopover(t){window._popover=await n.create({component:"popover-profile",cssClass:"presentPopover",event:t,translucent:!0}),await window._popover.present()}async connectedCallback(){try{window.location.search.match(/\?code.*state.*/g)&&(a.type="indeterminate",a.hidden=!1,await r.handleRedirectCallback(),window.history.replaceState({},document.title,"/")),this.user=await r.getUser()}catch({message:t}){i(t)}finally{a.type="determinate",a.hidden=!0}}render(){return o(e,null,o("ion-header",null,o("ion-toolbar",{color:"primary"},o("ion-title",null,"Home"),o("ion-buttons",{slot:"primary"},this.user?o("ion-avatar",{onClick:t=>this.presentPopover(t)},o("img",{src:this.user?.picture})):o("ion-button",{onClick:()=>this.login()},"Log in")))),o("ion-content",{class:"ion-padding"},o("ion-button",{onClick:()=>this.callAPI(),hidden:!this.user},"Call API"),o("img",{id:"result"})))}};s.style=".presentPopover .popover-content{}ion-buttons{margin-right:20px}ion-avatar{height:48px;width:48px}";export{s as app_home}